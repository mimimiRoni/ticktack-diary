name: Go Format Check

on:
  workflow_dispatch:
  pull_request:
    branches:
      - main
      - develop

jobs:
  gofmt:
    name: Check gofmt
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write # PR ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ããŸã‚ã®æ¨©é™

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.23.6"

      - name: Run gofmt
        id: gofmt
        run: |
          FORMATTING_ISSUES=$(gofmt -l .)
          if [ -n "$FORMATTING_ISSUES" ]; then
            echo "gofmt failed"
            echo "$FORMATTING_ISSUES"
            echo "::set-output name=failed::true"
            echo "::set-output name=issues::$FORMATTING_ISSUES"
            exit 1
          fi

      - name: Comment on PR if gofmt fails
        if: failure()
        run: |
          gh pr comment "$PR_URL" --body "âš ï¸ gofmt check failed!
          ğŸš€ ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¿®æ­£ã—ã¦ãã ã•ã„:  
          \`\`\`sh
          gofmt -w .
          \`\`\`
          ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“:
          - ${{ steps.gofmt.outputs.issues }}
          ğŸ“ **ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚ŒãŸã‚³ãƒŸãƒƒãƒˆ**: [${{ github.sha }}]($COMMIT_URL)"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_URL: ${{ github.event.pull_request.html_url }}
